\chapter{Partitioned finite element method}\label{ch:pfem}

\epigraph{Every truth is simple\dots is that not doubly a lie?}{\textit{Twilight of the Idols \\ Friedrich Nietzsche}}

\minitoc

\lettrine{\color{theme}{D}}iscretization is the process of transferring continuous models into discrete counterparts. The discrete model should be faithful to the continuous one. To this aim, it is usually essential that the main properties of the continuous system are preserved at the discrete level. An algorithm that is capable of conserving properties at the discrete level is called structure-preserving \cite{christiansen2011}. In this chapter, a finite element method to spatially discretize infinite-dimensional pHs into finite-dimensional ones in a structure preserving manner is illustrated.

\section{Discretization under uniform boundary condition}
A discrete version of a infinite-dimensional pH system is meant to preserve the underlying properties related to power continuity. To achieve this purpose, the discretization procedure consists of two steps \cite{kotyczka2018weak}:
\begin{itemize}
	\item Finite-dimensional approximation of the Stokes-Dirac structure, i.e. the formally skew symmetric differential operator that defines the structure. The duality of the power variables has to be mapped onto the finite approximation. The subspace of the discrete variables will be represented by a Dirac structure. 
	\item The Hamiltonian requires as well a suitable discretization, which gives rise to a discrete Hamiltonian. 
\end{itemize} 
A structure-preserving discretization is able to construct an equivalent pH system that possess the structural properties of the original model:
\begin{tcbraster}[raster columns=2, raster equal height]
	\begin{tcolorbox}[width=0.4\textwidth, nobeforeafter, colframe=theme,title=Infinite dimensional pH system]%%
		PDE with distributed inputs:
		\begin{align*}
		\diffp{\bm{\alpha}}{t}(\bm{x}, t) &= \mathcal{J} {\displaystyle \diffd{H}{\bm{\alpha}}}+ \mathcal{B} \textcolor{red}{\bm{u}(\bm{x}, t)}, \\
		\textcolor{red}{\bm{y}(\bm{x}, t)} &= \mathcal{B}^* {\displaystyle \diffd{H}{\bm{\alpha}}}.
		\end{align*}
		Boundary conditions: 
		\[\textcolor{blue}{\bm{u}_\partial} = \mathcal{B}_\partial{\displaystyle \diffd{H}{\bm{\alpha}}}, \quad \textcolor{blue}{\bm{y}_\partial} = \mathcal{C}_\partial {\displaystyle \diffd{H}{\bm{\alpha}}}. \]
		Power balance (Stokes Theorem): 
		\[ \dot{H} = \displaystyle \int_{\partial \Omega} \textcolor{blue}{\bm{u}_\partial} \cdot \textcolor{blue}{\bm{y}_\partial} \d{S} +  \int_{\Omega} \textcolor{red}{\bm{u}} \cdot \textcolor{red}{\bm{y}} \d{\Omega}.
		\]
	\end{tcolorbox} 
	\begin{tcolorbox}[width=0.4\textwidth, nobeforeafter,  colframe=theme,title=Structure-preserving discretization]%%
		Resulting ODE:
		\begin{align*}
		\dot{\bm{\alpha}}_d &= \mathbf{J} \, {\nabla {H}_d} + \mathbf{B}_d \textcolor{red}{\mathbf{u}_d} + \mathbf{B}_\partial \textcolor{blue}{\mathbf{u}_\partial}, \\
		\textcolor{red}{\mathbf{y}_d} &= \mathbf{B}_d^\top \, {\nabla {H}_d}, \\
		\textcolor{blue}{\mathbf{y}_\partial} &= \mathbf{B}_\partial^\top \,{\nabla {H}_d}.
		\end{align*}
		Discretized Hamiltonian:
		\[
		H_d := H(\bm{\alpha} \equiv \bm{\alpha}_d).
		\]
		Power balance: 
		\[ \dot{H} = \textcolor{blue}{\mathbf{u}_\partial^\top \mathbf{y}_\partial} +  \textcolor{red}{\mathbf{u}_d^\top \mathbf{y}_d}.
		\]
	\end{tcolorbox}
\end{tcbraster}
\vspace{.5cm}
In this thesis the partitioned finite element method (PFEM), originally presented in \cite{cardoso2018pfem,cardoso2019partitioned}, is chosen to obtain discretized models of dpHs. This procedure boils down to three simple steps
\begin{enumerate}
	\item The system is written in weak form; 
	\item An integration by parts is applied to highlight the appropriate boundary control;
	\item A Galerkin method is employed to obtain a finite-dimensional system.
\end{enumerate}

Once the system has been put into weak form, a subset of the equations is integrated by parts, so that boundary variables are naturally included into the formulation and appear as control inputs, the collocated outputs being defined accordingly. The discretization of energy and co-energy variables (and the associated test functions) leads directly to a full rank representation for the finite-dimensional pH system.  This approach makes possible the usage of FEM software, like FEniCS \cite{logg2012}, or Firedrake \cite{rathgeber2017firedrake}. \\

Despite the many advantages, this methodology allows obtaining a canonical pH finite dimensional system only under a uniform causality assumption. The case of mixed boundary conditions requires additional care and will be treated in the subsequent Section \secref{sec:mixedbc}.


\subsection{General procedure}\label{sec:pfem_gen}
Given an open connected set $\Omega \in \mathbb{R}^d,\, d= \{1,2,3\}$, consider a generic pH system defined on~$\Omega$
\begin{subequations}
\label{eq:pHsys_2}
\begin{align}
\partial_t {\bm{\alpha}} &= \mathcal{J}\displaystyle \bm{e}, \qquad \;\;\, \bm{\alpha} \in X, \label{eq:pHsys_dyn} \vspace{3pt}\\
\bm{e} :&= \displaystyle \delta_{\bm{\alpha}}H, \qquad \;\; \bm{e} \in H^\mathcal{J}, \label{eq:pHsys_const} \\
\bm{u}_\partial &= \mathcal{B}_\partial  \displaystyle \bm{e}, \qquad \bm{u}_\partial \in \mathbb{R}^m, \label{eq:pHsys_u} \vspace{3pt}\\
\bm{y}_\partial &= \mathcal{C}_\partial \displaystyle \bm{e}, \qquad \; \bm{y}_\partial \in \mathbb{R}^m. \label{eq:pHsys_y} \vspace{3pt}
\end{align}
\end{subequations}
The Hilbert space $X$, whose inner product is denoted by $\inner[X]{\cdot}{\cdot}$, is an appropriate Cartesian product of $L^2$ spaces which account for the nature of each variable (that can be scalar, vectorial or tensorial quantities). Its precise definition depends on the example upon consideration. For scalars $(a,b) \in L^2(\Omega)$, vectors $(\bm{a}, \bm{b})\in L^2(\Omega, \mathbb{R}^d)$ and tensors  $(\bm{A}, \bm{B}) \in L^2(\Omega,\mathbb{R}^{d\times d})$ the $L^2$ inner product is given by 
\begin{equation}
\inner[L^2(\Omega)]{a}{b} = \int_{\Omega} a b \d\Omega, \qquad \inner[L^2(\Omega, \mathbb{R}^d)]{\bm{a}}{\bm{b}} = \int_{\Omega} \bm{a} \cdot \bm{b} \d\Omega, \qquad \inner[L^2(\Omega, \mathbb{R}^{d \times d})]{\bm{A}}{\bm{B}} = \int_{\Omega} \bm{A} \cddot \bm{B} \d\Omega.
\end{equation} 

 The Hilbert space $H^\mathcal{J}$ is defined to be 
\begin{equation}
	H^\mathcal{J} :=\left\{\bm{u} \in X \vert \; \mathcal{J}\bm{u} \in X  \right\}.
\end{equation}
 The Hamiltonian functional of Eq. \eqref{eq:pHsys_const} is allowed to be non linear in the energy variables
\begin{equation*}
H = \int_\Omega \mathcal{H}(\bm{\alpha}) \d\Omega,
\end{equation*}
where $\mathcal{H}(\bm{\alpha}): X \rightarrow \mathbb{R}$ is a non linear function.
\\

To applied this methodology the non linearities are restricted to the Hamiltonian and a uniform causality condition is supposed to characterize the system. It is required as well that the system admits a splitting of the variables. This requirement is always encounter in the following examples. These hypotheses are resumed in the following assumptions.

\begin{assumption}\label{ass:linJ}
	Consider system \eqref{eq:pHsys_dyn}. It is assumed that the Hilbert space $X$ admits the splitting $X = X_1 \times X_2$ (meaning that the system is made up of two main blocks). The operator $\mathcal{J}$ is assumed to be skew-symmetric (or formally skew-adjoint) on $X$ and linear:
	\begin{equation}\label{eq:assJ}
	\mathcal{J} = \mathcal{J}_{{a}} + \mathcal{J}_{{d}},
	\end{equation}
	where $\mathcal{J}_{\text{a}}$ is the algebraic contribution (a skew-symmetric matrix) and $\mathcal{J}_{\text{d}}$ the differential contribution. The algebraic part is assumed to take the form
	\begin{equation}\label{eq:assJa}
		\mathcal{J}_{{a}} = \begin{bmatrix}
		0 & -\bm{L}^\top \\
		\bm{L} & 0 \\
		\end{bmatrix}, \qquad 
		\begin{aligned}
		&\bm{L}^\top : X_2 \rightarrow X_1, \\
		&\bm{L}\;\, : X_1 \rightarrow X_2, \\
		\end{aligned}
	\end{equation}
	where $\bm{L}$ is a matrix (a bounded operator). 	Analogously, the linear differential operator $\mathcal{J}_{{d}}$ is assumed to be of the form
	\begin{equation}\label{eq:assJd}
	\mathcal{J}_{\text{d}} = 
	\begin{bmatrix}
	0 & -\mathcal{L}^* \\
	\mathcal{L} & 0 \\
	\end{bmatrix}, \qquad 
	\begin{aligned}
	&\mathcal{L}^* : X_2 \rightarrow X_1, \\
	&\mathcal{L}\;\, : X_1 \rightarrow X_2, \\
	\end{aligned}
	\end{equation}
	where $\mathcal{L}^*$ denotes the formal adjoint of the linear differential operator $\mathcal{L}$.
	The operator $\mathcal{L}$ is unbounded and  can be either a first order or a second order differential operator. In the latter case it can be expressed as $\mathcal{L} = \mathcal{L}_1 \circ \mathcal{L}_2$. Given the splitting $X_1 \times X_2 = X$ the Hilbert space $H^\mathcal{J}$ can be split as well as 
	\begin{equation}
		H^\mathcal{J} = H^\mathcal{L} \times H^\mathcal{-L^*}, \qquad
		\begin{aligned}
		H^\mathcal{L} &:= \left\{\bm{u}_1 \in X_1 \vert \; \mathcal{L}\bm{u}_1 \in X_2 \right\}, \\
		H^\mathcal{-L^*} &:= \left\{\bm{u}_2 \in X_2 \vert \; -\mathcal{L}^*\bm{u}_2 \in X_1 \right\}
		\end{aligned}
	\end{equation}
\end{assumption}

From Theorem \ref{th:rogers}, given $(\bm{u}_1, \, \bm{u}_2) \in H^\mathcal{L} \times H^\mathcal{-L^*}= H^{\mathcal{J}}$, it holds
\begin{equation}
\inner[X_2]{\bm{u}_2}{\mathcal{L}\, \bm{u}_1}  - \inner[X_1]{\mathcal{L}^* \, \bm{u}_2} {\bm{u}_1} = \int_{\Omega }\div\widetilde{\mathcal{A}}_{\mathcal{L}}(\bm{u}_1, \bm{u}_2) \d\Omega. \\
\end{equation}
The integration by part formula provides 
\begin{equation}\label{eq:intbypartsJ} 
\inner[X_2]{\bm{u}_2}{\mathcal{L}\,\bm{u}_1} - \inner[X_1]{\mathcal{L}^* \, \bm{u}_2}{\bm{u}_1} = \inner[X_\partial]{\mathcal{N}_{\partial, 1} \bm{u}_1}{\mathcal{N}_{\partial, 2} \bm{u}_2}, \where X_\partial = L^2(\partial \Omega, \mathbb{R}^m). 
\end{equation}

\begin{remark}
	The integration by part formula establishes a duality pairing between Sobolev spaces. This duality pairing is then compatible with an $L^2$ inner product in presence of a rigged Hilbert space (Gelfand triple). Without entering into technical details, we shall always use this equivalence of representation. Therefore, the boundary integrals are  expressed as $L^2$ inner product over the boundary. 
\end{remark}

 The boundary operators are then supposed to fulfill the following assumption, that guarantees a uniform causality condition.


\begin{assumption}\label{ass:operBC}
	The boundary operators $\mathcal{B}_\partial, \, \mathcal{C}_\partial$ of Eqs. \eqref{eq:pHsys_u}, \eqref{eq:pHsys_y}, are assumed to verify, in an exclusive manner, either
	\begin{equation}\label{eq:assB2C1}
	\mathcal{B}_\partial = \begin{bmatrix}
	0 & \mathcal{N}_{\partial, 2} \\
	\end{bmatrix}, \quad 
	\mathcal{C}_\partial = \begin{bmatrix}
	\mathcal{N}_{\partial, 1} & 0 \\
	\end{bmatrix}
	\end{equation}
	or 
	\begin{equation}\label{eq:assB1C2}
	\mathcal{B}_\partial = \begin{bmatrix}
	\mathcal{N}_{\partial, 1} & 0 \\
	\end{bmatrix}, \quad \mathcal{C}_\partial = \begin{bmatrix}
	0 & \mathcal{N}_{\partial, 2} \\
	\end{bmatrix}
	\end{equation}
	where the operators $\mathcal{N}_{\partial, 1}, \; \mathcal{N}_{\partial, 2}$ are defined by the integration by part formula \eqref{eq:intbypartsJ}. 

\end{assumption}

Thanks to Assumption \ref{ass:linJ}, \ref{ass:operBC}, System \eqref{eq:pHsys_2} is rewritten as 
\begin{subequations}
	\label{eq:pHsys_ass} 
	\begin{align}
	\partial_t \begin{pmatrix}
	{\bm{\alpha}}_1 \\ {\bm{\alpha}}_2
	\end{pmatrix} &= \begin{bmatrix}
	0 & -\bm{L}^\top - \mathcal{L}^* \\
	\bm{L} + \mathcal{L} & 0 \\
	\end{bmatrix}\begin{pmatrix}
	\bm{e}_1 \\ \bm{e}_2
	\end{pmatrix} , \qquad \begin{aligned}
	\bm{\alpha}_1 \in X_1, 	\\
	\bm{\alpha}_2 \in X_2, 
	\end{aligned} \label{eq:pHsys_dyn_ass} \vspace{3pt}\\
	\begin{pmatrix}
	\bm{e}_1 \\ \bm{e}_2
	\end{pmatrix} &:= \begin{pmatrix}
	\delta_{\bm{\alpha}_1}H \\ \delta_{\bm{\alpha}_2}H
	\end{pmatrix} , \qquad \begin{aligned}
	\bm{e}_1 &\in H^\mathcal{L}, 	\\
	\bm{e}_2 &\in H^{-\mathcal{L}^*}.
	\end{aligned} \label{eq:pHsys_const_ass} 
	\end{align}
\end{subequations}
Then if Eq. \eqref{eq:assB2C1} holds the boundary variables equal 
\begin{equation}\label{eq:pHsys_assB2C1}
\bm{u}_\partial = \mathcal{N}_2 \displaystyle \bm{e}_2, \qquad  \bm{y}_\partial = \mathcal{N}_1 \displaystyle \bm{e}_1, \qquad  \bm{u}_\partial,\, \bm{y}_\partial \in \mathbb{R}^m.
\end{equation}

Otherwise, if Eq. \eqref{eq:assB1C2} holds, then
\begin{equation}\label{eq:pHsys_assB1C2}
\bm{u}_\partial = \mathcal{N}_1 \displaystyle \bm{e}_1, \qquad 
\bm{y}_\partial = \mathcal{N}_2 \displaystyle \bm{e}_2, \qquad  \bm{u}_\partial,\, \bm{y}_\partial \in \mathbb{R}^m. 
\end{equation}
In both cases, the power balance reads
\begin{equation}\label{eq:powbal_2}
\begin{aligned}
\dot{H} &= \inner[X_1]{\bm{e}_1}{\partial_{t} \bm{\alpha}_1} + \inner[X_2]{\bm{e}_2}{\partial_{t} \bm{\alpha}_2}, \\
&=\inner[X_1]{\bm{e}_1}{-\mathcal{L}^* \bm{e}_2} + \inner[X_2]{\bm{e}_2}{\mathcal{L} \bm{e}_1}, \\
&= \inner[X_\partial]{\mathcal{N}_{\partial, 1} \bm{e}_1}{\mathcal{N}_{\partial, 2} \bm{e}_2}, \\
&= \inner[X_\partial]{\bm{y}_\partial}{\bm{u}_\partial}.
\end{aligned}
\end{equation}
We are now in a position to illustrate the methodology. 
\paragraph{Step 1} First consider the weak form of system \eqref{eq:pHsys_dyn_ass}, obtained by taking the $L^2$ inner product introducing an appropriate test function $\bm{v} = (\bm{v}_1, \bm{v}_2) \in X_1 \times X_2 = X$ and integrating over the domain $\Omega$
\begin{equation}\label{eq:weak_dyn}
\begin{aligned}
\inner[X_1]{\bm{v}_1}{\partial_t \bm{\alpha}_1} &= -  \langle{\bm{v}_1},\,{\bm{L}^\top \bm{e}_2}\rangle_{X_1} -  \inner[X_1]{\bm{v}_1}{\mathcal{L}^*\bm{e}_2}, \\
\inner[X_2]{\bm{v}_2}{\partial_t \bm{\alpha}_2} &= \inner[X_2]{\bm{v}_2}{\bm{L}\bm{e}_1}+ \inner[X_2]{\bm{v}_2}{\mathcal{L}\bm{e}_1}.
\end{aligned}
\end{equation}



To obtain a closed system, the constitutive law \eqref{eq:pHsys_const_ass} and the output variables \eqref{eq:pHsys_y} are put in weak form
\begin{equation}
\begin{aligned}
\inner[X_1]{\bm{v}_1}{\bm{e}_1}&= \inner[X_1]{\bm{v}_1}{\delta_{\bm{\alpha}_1} H}, \\
\inner[X_2]{\bm{v}_2}{\bm{e}_2}&= \inner[X_2]{\bm{v}_2}{\delta_{\bm{\alpha}_2} H}, \\
\inner[X_\partial]{\bm{v}_\partial}{\bm{y}_\partial} &= \inner[X_\partial]{\bm{v}_\partial}{\mathcal{C}_\partial \bm{e}},
\end{aligned}
\end{equation}
where the test function $\bm{v}_\partial \in X_\partial = L^2(\partial \Omega, \mathbb{R}^m)$ is defined on the boundary $\partial\Omega$ and $\mathcal{C}_\partial$ is defined either by Eq. \eqref{eq:assB2C1} or  \eqref{eq:assB1C2}.


\paragraph{Step 2} Next the integration by part has to be carried out. The choice is dictated by the boundary control to be imposed on the system. Consider again Eq. \eqref{eq:weak_dyn}. The integration by parts can be carried out either on term $-\inner[X_1]{\bm{v}_1}{\mathcal{L}^*\bm{e}_2}$, or on term $\inner[X_2]{\bm{v}_2}{\mathcal{L}\bm{e}_1}$. Depending o which line undergoes the integration by parts (this explains the name Partitioned Finite Element method), two structure preserving weak forms are obtained. These differ by the boundary causality imposed to the system. 


\subparagraph{Integration by parts of the term $-\inner[X_1]{\bm{v}_1}{\mathcal{L}^*\bm{e}_2}$}
In this case case, using Eq. \eqref{eq:intbypartsJ}, it is obtained 
\begin{equation}
-\inner[X_1]{\bm{v}_1}{\mathcal{L}^*\bm{e}_2} = -\inner[X_2]{\mathcal{L}\bm{v}_1}{\bm{e}_2} + \inner[X_\partial]{\mathcal{N}_{\partial, 1} \bm{v}_1}{\mathcal{N}_{\partial, 2} \bm{e}_2}.
\end{equation}
Then the weak form of the system dynamics  reads 
\begin{equation}\label{eq:weak_dyn_intJ1}
\begin{aligned}
\inner[X_1]{\bm{v}_1}{\partial_t \bm{\alpha}_1} &=   -  \langle{\bm{v}_1}, \,{\bm{L}^\top \bm{e}_2}\rangle_{X_1}  -\inner[X_2]{\mathcal{L}\bm{v}_1}{\bm{e}_2} + \inner[X_\partial]{\mathcal{N}_{\partial, 1} \bm{v}_1}{\bm{u}_\partial}, \\
\inner[X]{\bm{v}}{\partial_t \bm{\alpha}} &=   \inner[X_2]{\bm{v}_2}{\bm{L}\bm{e}_1} + \inner[X_2]{\bm{v}_2}{\mathcal{L}\bm{e}_1},
\end{aligned}
\end{equation}
The following proposition is crucial as the lossless character of the infinite-dimensional system (due to the formally skew-adjoint operator) translates into an equivalent property for the corresponding bilinear form in the weak form.
\begin{proposition}
	Given the Hilbert space $H^{\mathcal{L}}_2 := H^\mathcal{L} \times X_2$ and variables $\bm{v} = (\bm{v}_1, \bm{v}_2) \in H^{\mathcal{L}}_2, \; \bm{e} = (\bm{e}_1, \bm{e}_2) \in H^{\mathcal{L}}_2$, the bilinear form 
	\begin{equation*}
	\begin{aligned}
	j_\mathcal{L}: H^{\mathcal{L}}_2 \times H^{\mathcal{L}}_2 &\longrightarrow \mathbb{R}, \\
	(\bm{v}, \bm{e}) &\longrightarrow -\inner[X_2]{\mathcal{L}\bm{v}_1}{\bm{e}_2} + \inner[X_2]{\bm{v}_2}{\mathcal{L}\bm{e}_1}
	\end{aligned}
	\end{equation*}
	is skew-symmetric.
	\begin{proof}
		The proof is obtained by the following computation
		\begin{equation*}
		\begin{aligned}
		j_\mathcal{L}(\bm{v}, \bm{e}) &= -\inner[X_2]{\mathcal{L}\bm{v}_1}{\bm{e}_2} + \inner[X_2]{\bm{v}_2}{\mathcal{L}\bm{e}_1}, \\
		&= - \left( - \inner[X_2]{\bm{v}_2}{\mathcal{L}\bm{e}_1} + \inner[X_2]{\mathcal{L}\bm{v}_1}{\bm{e}_2}\right), \\
		&= - \left( - \inner[X_2]{\mathcal{L}\bm{e}_1}{\bm{v}_2} + \inner[X_2]{\bm{e}_2}{\mathcal{L}\bm{v}_1}\right) = - j_\mathcal{L}(\bm{e}, \bm{v}).
		\end{aligned}
		\end{equation*}
	\end{proof}
\end{proposition}

Now assume that the system satisfies the boundary causality condition \ref{eq:pHsys_assB2C1}. Then, this choice of the integration by parts lead to the following weak formulation
\begin{equation}\label{eq:weak_sys_intJ1}
\begin{aligned}
\inner[X_1]{\bm{v}_1}{\partial_t \bm{\alpha}_1} &=   -  \langle{\bm{v}_1}, \,{\bm{L}^\top \bm{e}_2}\rangle_{X_1}  -\inner[X_2]{\mathcal{L}\bm{v}_1}{\bm{e}_2} + \inner[X_\partial]{\mathcal{N}_{\partial, 1} \bm{v}_1}{\bm{u}_\partial}, \\
\inner[X_2]{\bm{v}_2}{\partial_t \bm{\alpha}_2} &=   \inner[X_2]{\bm{v}_2}{\bm{L}\bm{e}_1} + \inner[X_2]{\bm{v}_2}{\mathcal{L}\bm{e}_1}, \\
\inner[X_1]{\bm{v}_1}{\bm{e}_1}&= \inner[X_1]{\bm{v}_1}{\delta_{\bm{\alpha}_1} H}, \\
\inner[X_2]{\bm{v}_2}{\bm{e}_2}&= \inner[X_2]{\bm{v}_2}{\delta_{\bm{\alpha}_2} H}, \\
\inner[X_\partial]{\bm{v}_\partial}{\bm{y}_\partial} &= \inner[X_\partial]{\bm{v}_\partial}{\mathcal{N}_{\partial, 1}\bm{e}_2}.
\end{aligned}
\end{equation}

\subparagraph{Integration by parts of the term $\inner[X_2]{\bm{v}_2}{\mathcal{L}\bm{e}_1}$}
Using Eq. \eqref{eq:intbypartsJ}, it is obtained 
\begin{equation}
\inner[X_2]{\bm{v}_2}{\mathcal{L}\bm{e}_1} = \inner[X_1]{\mathcal{L}^*\bm{v}_2}{\bm{e}_1} + \inner[X_\partial]{\mathcal{N}_{\partial, 2} \bm{v}_2}{\mathcal{N}_{\partial, 1} \bm{e}_1}.
\end{equation}
Then the weak form of the system dynamics  reads 
\begin{equation}\label{eq:weak_dyn_intJ2}
\begin{aligned}
\inner[X_1]{\bm{v}_1}{\partial_t \bm{\alpha}_1} &=   -  \langle{\bm{v}_1}, \,{\bm{L}^\top \bm{e}_2}\rangle_{X_1}  -\inner[X_1]{\bm{v}_1}{\mathcal{L}^*\bm{e}_2}, \\
\inner[X_2]{\bm{v}_2}{\partial_t \bm{\alpha}_2} &=   \inner[X_2]{\bm{v}_2}{\bm{L}\bm{e}_1}  + \inner[X_1]{\mathcal{L}^*\bm{v}_2}{\bm{e}_1} + \inner[X_\partial]{\mathcal{N}_{\partial, 2} \bm{v}_2}{\bm{u}_{\partial}}, \\
\end{aligned}
\end{equation}
Again the bilinear form arising from the formally skew-adjoint operator is skew-symmetric.
\begin{proposition}
	Given the Hilbert space $H^{-\mathcal{L}^*}_1 = X_1 \times H^{-\mathcal{L}^*}$ and variables $\bm{v} = (\bm{v}_1, \bm{v}_2) \in H^{-\mathcal{L}^*}_1, \; \bm{e} = (\bm{e}_1, \bm{e}_2) \in H^{-\mathcal{L}^*}_1$, the bilinear form 
	\begin{equation*}
	\begin{aligned}
	j_{-\mathcal{L}^*}: H^{-\mathcal{L}^*}_1 \times H^{-\mathcal{L}^*}_1 &\longrightarrow \mathbb{R}, \\
	(\bm{v}, \bm{e}) &\longrightarrow -\inner[X_1]{\bm{v}_1}{\mathcal{L}^*\bm{e}_2} + \inner[X_1]{\mathcal{L}^*\bm{v}_2}{\bm{e}_1}
	\end{aligned}
	\end{equation*}
	is skew-symmetric.
	\begin{proof}
		The proof follows from the computation
		\begin{equation*}
		\begin{aligned}
		j_{-\mathcal{L}^*}(\bm{v}, \bm{e}) &= -\inner[X_1]{\bm{v}_1}{\mathcal{L}^*\bm{e}_2} + \inner[X_1]{\mathcal{L}^*\bm{v}_2}{\bm{e}_1}, \\
		&= - \left(-\inner[X_1]{\mathcal{L}^*\bm{v}_2}{\bm{e}_1} + \inner[X_1]{\bm{v}_1}{\mathcal{L}^*\bm{e}_2}\right), \\
		&= - \left(-\inner[X_1]{\bm{e}_1}{\mathcal{L}^*\bm{v}_2} + \inner[X_1]{\mathcal{L}^*\bm{e}_2}{\bm{v}_1}\right) = - j_{-\mathcal{L}^*}(\bm{e}, \bm{v}).
		\end{aligned}
		\end{equation*}
	\end{proof}
\end{proposition}

Now assume that the system satisfies the boundary causality condition \eqref{eq:pHsys_assB1C2}. Then, the final weak formulation reads
\begin{equation}\label{eq:weak_sys_intJ2}
\begin{aligned}
\inner[X_1]{\bm{v}_1}{\partial_t \bm{\alpha}_1} &=   -  \langle{\bm{v}_1}, \,{\bm{L}^\top \bm{e}_2}\rangle_{X_1}  -\inner[X_1]{\bm{v}_1}{\mathcal{L}^*\bm{e}_2}, \\
\inner[X_2]{\bm{v}_2}{\partial_t \bm{\alpha}_2} &=   \inner[X_2]{\bm{v}_2}{\bm{L}\bm{e}_1}  + \inner[X_1]{\mathcal{L}^*\bm{v}_2}{\bm{e}_1} + \inner[X_\partial]{\mathcal{N}_{\partial, 2} \bm{v}_2}{\bm{u}_{\partial}}, \\
\inner[X_1]{\bm{v}_1}{\bm{e}_1}&= \inner[X_1]{\bm{v}_1}{\delta_{\bm{\alpha}_1} H}, \\
\inner[X_2]{\bm{v}_2}{\bm{e}_2}&= \inner[X_2]{\bm{v}_2}{\delta_{\bm{\alpha}_2} H}, \\
\inner[X_\partial]{\bm{v}_\partial}{\bm{y}_\partial} &= \inner[X_\partial]{\bm{v}_\partial}{\mathcal{N}_{\partial, 2}\bm{e}_2}.
\end{aligned}
\end{equation}

\paragraph{Galerkin discretization}
To conclude the illustration of this methodology, consider a Galerkin discretization is introduced. This means that test, energy and co-energy functions are discretized using the same basis. Furthermore the boundary variables are discretized as well using bases defined over the boundary
\begin{equation}\label{eq:approx_vaeb}
\begin{aligned}
\bm{v}_1 &\approx \sum_{i=1}^{n_1} \bm{\phi}_1^i(\bm{x}) v_1^i, \\
\bm{v}_2 &\approx \sum_{i=1}^{n_2} \bm{\phi}_2^i(\bm{x}) v_2^i, \\
\bm{v}_\partial &\approx \sum_{i=1}^{n_\partial} \bm{\phi}_\partial^i(\bm{s}) v_\partial^i,
\end{aligned} \qquad 
\begin{aligned}
\bm{\alpha}_1 &\approx \sum_{i=1}^{n_1} \bm{\phi}_1^i(\bm{x}) \alpha_1^i(t), \\
\bm{\alpha}_2 &\approx \sum_{i=1}^{n_2} \bm{\phi}_2^i(\bm{x}) \alpha_2^i(t), \\
\bm{u}_\partial &\approx \sum_{i=1}^{n_\partial} \bm{\phi}_\partial^i(\bm{s}) u_\partial^i(t), 
\end{aligned} \qquad 
\begin{aligned}
\bm{e}_1 &\approx \sum_{i=1}^{n_1} \bm{\phi}_1^i(\bm{x}) e_1^i(t), \quad \bm{x} \in \Omega, \\
\bm{e}_2 &\approx \sum_{i=1}^{n_2} \bm{\phi}_2^i(\bm{x}) e_2^i(t), \quad \bm{x} \in \Omega,\\
\bm{y}_\partial &\approx \sum_{i=1}^{n_\partial} \bm{\phi}_\partial^i(\bm{s}) y_\partial^i(t), \quad \bm{s} \in \partial\Omega.
\end{aligned}
\end{equation}

\subparagraph{Discretization of the weak form \eqref{eq:weak_sys_intJ1}}
Plugging the approximation into the weak form \eqref{eq:weak_sys_intJ1} and consider that the resulting equation holds $\forall \, v_1^i,\, v_2^j,\, v_\partial^k \; (i\in\left\{1,n_1\right\}, \; j\in\left\{1,n_2\right\}, \; k\in\left\{1,n_\partial\right\})$, the finite dimensional system is obtained

\begin{equation}\label{eq:pHsys_findim_J1}
\begin{aligned}
\begin{bmatrix}
\mathbf{M}_1 & \mathbf{0} \\
\mathbf{0} & \mathbf{M}_2 \\
\end{bmatrix}
\begin{pmatrix}
\dot{\bm{\alpha}}_{d, 1} \\
\dot{\bm{\alpha}}_{d, 2} \\
\end{pmatrix}
&= \begin{bmatrix}
\mathbf{0} & -\mathbf{D}_{0}^\top - \mathbf{D}_{\mathcal{L}}^\top \\
\mathbf{D}_{0} + \mathbf{D}_{\mathcal{L}} & \mathbf{0} \\
\end{bmatrix} 
\begin{pmatrix}
\mathbf{e}_{1} \\
\mathbf{e}_{2} \\
\end{pmatrix} + 
\begin{bmatrix}
\mathbf{B}_1\\
\mathbf{0}\\
\end{bmatrix}
\mathbf{u}_\partial, \\
\begin{bmatrix}
\mathbf{M}_1 & \mathbf{0} \\
\mathbf{0} & \mathbf{M}_2 \\
\end{bmatrix}
\begin{pmatrix}
\mathbf{e}_{1} \\
\mathbf{e}_{2} \\
\end{pmatrix}
&= \begin{bmatrix}
\partial_{\bm{\alpha}_{d, 1}} H_d(\bm{\alpha}_d)\\
\partial_{\bm{\alpha}_{d, 2}} H_d(\bm{\alpha}_d)\\
\end{bmatrix}, \\
\mathbf{M}_\partial {\mathbf{y}_\partial} &= \begin{bmatrix}
\mathbf{B}_1^\top & \mathbf{0}
\end{bmatrix}\begin{pmatrix}
\mathbf{e}_{1} \\
\mathbf{e}_{2} \\
\end{pmatrix}.
\end{aligned}
\end{equation}
Vectors $\bm{\alpha}_{d, 1},\, \bm{\alpha}_{d, 2}, \, \mathbf{e}_{1}, \, \mathbf{e}_{2}, \, \mathbf{u}_\partial, \, \mathbf{y}_\partial$ are given by the column-wise concatenation of their respective degrees of freedom. The matrices are defined as follows 
\begin{equation}
\begin{aligned}
M_1^{ij} &= \inner[X_1]{\bm\phi_1^i}{\bm\phi_1^j}, \\
M_2^{mn} &= \inner[X_2]{\bm\phi_2^m}{\bm\phi_2^n}, \\
\end{aligned}\quad
\begin{aligned}
{D}_{0}^{mi} &= \inner[X_2]{\bm\phi_2^m}{\bm{L}\bm\phi_1^i}, \\
{D}_{\mathcal{L}}^{mi} &= \inner[X_2]{\bm\phi_2^m}{\mathcal{L}\bm\phi_1^i}, 
\end{aligned}\quad  
\begin{aligned}
{B}_{1}^{ik} = \inner[X_\partial]{\bm\phi_1^i}{\bm\phi_\partial^k}, \\
M_\partial^{lk} = \inner[X_\partial]{\bm\phi_\partial^l}{\bm\phi_\delta^k},
\end{aligned}
\end{equation}
where $i, j \in \left\{1, n_1\right\}, \; m,n \in \left\{1, n_2\right\}, \; l, k \in \left\{1, n_\partial \right\}$. Introducing the definitions
\begin{align*}
	\delta_{\bm{\alpha}_{d, 1}} H_d := \delta_{\bm{\alpha}_{1}} H\left(\bm{\alpha}_1 = \sum_{i=1}^{n_1} \bm{\phi}_1^i \alpha_1^i, \;  \bm{\alpha}_2 = \sum_{i=1}^{n_1} \bm{\phi}_2^i \alpha_2^i\right), \\
	\delta_{\bm{\alpha}_{d, 2}} H_d := \delta_{\bm{\alpha}_{2}} H\left(\bm{\alpha}_1 = \sum_{i=1}^{n_1} \bm{\phi}_1^i \alpha_1^i, \;  \bm{\alpha}_2 = \sum_{i=1}^{n_1} \bm{\phi}_2^i \alpha_2^i\right),
\end{align*}
the discretized gradient of the Hamiltonian read
\begin{equation}
\begin{aligned}
\partial_{{\alpha}_{d, 1}^i} H_d(\bm{\alpha}_d) &= \inner[X_1]{\bm\phi_1^i}{\delta_{\bm{\alpha}_{d, 1}} H_d}, \qquad i \in \left\{1, n_1\right\}, \\
\partial_{{\alpha}_{d, 2}^j} H_d(\bm{\alpha}_d) &= \inner[X_2]{\bm\phi_2^j}{\delta_{\bm{\alpha}_{d, 2}} H_d}, \qquad j \in \left\{1, n_2\right\}.
\end{aligned}
\end{equation}
A pH system in canonical form is found observing that Sys. \eqref{eq:pHsys_findim_J1} is compactly rewritten as 
\begin{align}
\mathbf{M} \dot{\bm{\alpha}}_{d} &= \mathbf{J}_{\mathcal{L}} \mathbf{e} + \mathbf{B}\mathbf{u}_\partial, \label{eq:pH_findim_dyn1} \\
\mathbf{M} \mathbf{e} &= \nabla H_d(\bm{\alpha}_d), \label{eq:pH_findin_e}\\
\mathbf{M}_\partial {\mathbf{y}_\partial} &= \mathbf{B}^\top \mathbf{e},
\end{align}

where $\bm{\alpha}_{d}= (\bm{\alpha}_{d, 1}^\top \;\; \bm{\alpha}_{d, 2}^\top)^\top, \; \mathbf{e}= (\mathbf{e}_1^\top \;\; \mathbf{e}_2^\top)^\top, \; \nabla H_d(\bm{\alpha}_d) = (\partial_{\bm{\alpha}_{d, 1}}^\top H_d(\bm{\alpha}_d) \;\; \partial_{\bm{\alpha}_{d, 2}}^\top H_d(\bm{\alpha}_d))^\top$ and 
\begin{equation}
\mathbf{M} = \begin{bmatrix}
\mathbf{M}_1 & \mathbf{0} \\
\mathbf{0} & \mathbf{M}_2 \\
\end{bmatrix}, \qquad 
\mathbf{J}_\mathcal{L}= \begin{bmatrix}
\mathbf{0} & -\mathbf{D}_{0}^\top - \mathbf{D}_{\mathcal{L}}^\top \\
\mathbf{D}_{0} + \mathbf{D}_{\mathcal{L}} & \mathbf{0} \\
\end{bmatrix}, \qquad
\mathbf{B} =
\begin{bmatrix}
\mathbf{B}_1\\
\mathbf{0}\\
\end{bmatrix}.
\end{equation}
Plugging \eqref{eq:pH_findin_e} into \eqref{eq:pH_findim_dyn1}, a pH system in canonical form is obtained
\begin{equation}
	\begin{aligned}
	\dot{\bm{\alpha}}_{d} &= \mathbf{J}\, \nabla H_d(\bm{\alpha}_d) + \mathbf{B}\, \mathbf{u}_\partial,\\
	\widehat{\mathbf{y}}_\partial &= \mathbf{B}^\top \nabla H_d(\bm{\alpha}_d), 
	\end{aligned}
	\begin{aligned}
	\where \mathbf{J} &= \mathbf{M}^{-1} \mathbf{J}_\mathcal{L} \mathbf{M}^{-1},\\
	\where \widehat{\mathbf{y}}_\partial &= \mathbf{M}_\partial \mathbf{y}_\partial.
	\end{aligned}
\end{equation}
The structure preserving character of the method is evident from the preservation, at the discrete level of the power balance. The finite dimensional counterpart of the energy rate is given by
\begin{equation}
\begin{aligned}
\dot{H}_d &= \nabla^\top H_d(\bm{\alpha}_d) \dot{\bm{\alpha}}_d, \\
&= \nabla^\top H_d(\bm{\alpha}_d) \mathbf{J}\, \nabla H_d(\bm{\alpha}_d) + \nabla^\top H_d(\bm{\alpha}_d) \mathbf{B}\, \mathbf{u}_\partial, \qquad \text{Skew-symmetry of }\mathbf{J} \\
&= \widehat{\mathbf{y}}_\partial^\top \mathbf{u}_\partial.
\end{aligned}
\end{equation}
This result mimics its infinite dimensional equivalent \eqref{eq:powbal_2}.

\subparagraph{Discretization of the weak form \eqref{eq:weak_sys_intJ2}}
Plugging the approximation into the weak form \eqref{eq:weak_sys_intJ2} a finite dimensional system with a different causality is obtained

\begin{equation}\label{eq:pHsys_findim_J2}
\begin{aligned}
\begin{bmatrix}
\mathbf{M}_1 & \mathbf{0} \\
\mathbf{0} & \mathbf{M}_2 \\
\end{bmatrix}
\begin{pmatrix}
\dot{\bm{\alpha}}_{d, 1} \\
\dot{\bm{\alpha}}_{d, 2} \\
\end{pmatrix}
&= \begin{bmatrix}
\mathbf{0} & -\mathbf{D}_{0}^\top + \mathbf{D}_{-\mathcal{L}^*} \\
\mathbf{D}_{0} - \mathbf{D}_{-\mathcal{L}^*}^\top & \mathbf{0} \\
\end{bmatrix} 
\begin{pmatrix}
\mathbf{e}_{1} \\
\mathbf{e}_{2} \\
\end{pmatrix} + 
\begin{bmatrix}
\mathbf{0}\\
\mathbf{B}_2\\
\end{bmatrix}
\mathbf{u}_\partial, \\
\begin{bmatrix}
\mathbf{M}_1 & \mathbf{0} \\
\mathbf{0} & \mathbf{M}_2 \\
\end{bmatrix}
\begin{pmatrix}
\mathbf{e}_{1} \\
\mathbf{e}_{2} \\
\end{pmatrix}
&= \begin{pmatrix}
\partial_{\bm{\alpha}_{d, 1}} H_d(\bm{\alpha}_d)\\
\partial_{\bm{\alpha}_{d, 2}} H_d(\bm{\alpha}_d)\\
\end{pmatrix}, \\
\mathbf{M}_\partial {\mathbf{y}_\partial} &= 
\begin{bmatrix}
\mathbf{0} & \mathbf{B}_2^\top 
\end{bmatrix}\begin{pmatrix}
\mathbf{e}_{1} \\
\mathbf{e}_{2} \\
\end{pmatrix}.
\end{aligned}
\end{equation}
The differences with respect to formulation \eqref{eq:pHsys_findim_J1} reside in matrices $\mathbf{D}_{-\mathcal{L}^*}, \; \mathbf{B}_2$, whose definitions are
\begin{equation}
{D}_{-\mathcal{L}^*}^{im} = \inner[X_1]{\bm\phi_1^i}{\mathcal{-L^*}\bm\phi_2^m}, \qquad B_2^{mk} = \inner[X_\partial]{\bm\phi_2^m}{\bm\phi_{\partial}^k} \qquad i \in \left\{1, n_1\right\}, \; m \in \left\{1, n_2\right\},\; k \in \left\{1, n_\partial \right\}.
\end{equation}
System \eqref{eq:pHsys_findim_J2} can be put in canonical form by replacing the co-energy variables by the discretized gradient.

\paragraph{Example: the irrotational shallow water equations}
Consider as an example the shallow water equations detailed in Sec. \secref{sec:shallowwater}.  The flow is assumed to be irrotational ($\nabla \times \bm{v} = 0$). As a consequence the term $\bm{\mathcal{G}}$ in Eq. \eqref{eq:pHsys_shwater} vanishes.
To fulfill Assumption \ref{ass:operBC}, the incoming volumetric flow is known at the boundary. This imposes a uniform Neumann condition. This lead to the following boundary control system, defined on an open connected set $\Omega \subset \mathbb{R}^2$
\begin{equation}
\begin{aligned}
\diffp{}{t}
\begin{pmatrix}
\alpha_h \\
\bm{\alpha}_v \\
\end{pmatrix} &= -
\begin{bmatrix}
0 & \div \\
\grad & \bm{0}
\end{bmatrix}
\begin{pmatrix}
e_h \\
\bm{e}_v \\
\end{pmatrix}, \\
\begin{pmatrix}
e_h  \\
\bm{e}_v
\end{pmatrix}
&:=
\begin{pmatrix}
\delta_{\alpha_h} H\\
\delta_{\bm{\alpha}_v} H
\end{pmatrix} = 
\begin{pmatrix}
\frac{1}{2 \rho} \norm{\bm{\alpha}_v}^2 + \rho g \alpha_h, \\
\frac{1}{\rho} \alpha_h \bm{\alpha}_v.
\end{pmatrix}, \\
{u}_\partial &= - \bm{e}_v \cdot\bm{n}, \\
{y}_\partial &= {e}_h, \\
\end{aligned} \qquad 
\begin{aligned}
\alpha_h &\in L^2(\Omega), \\
\bm{\alpha}_v &\in L^2(\Omega, \mathbb{R}^2), \\
e_h &\in H^1(\Omega), \\
\bm{e}_v &\in H^{\div}(\Omega, \mathbb{R}^2), \\
u_\partial &\in \mathbb{R}, \\
y_\partial &\in \mathbb{R},
\end{aligned}
\end{equation} 
where the Hamiltonian is a non linear functional in the energy variables 
\begin{equation*}
H(\alpha_h, \bm{\alpha}_v) = \energy{\frac{1}{\rho} \alpha_h \norm{\bm{\alpha}_v}^2 + \rho g \alpha_h^2}.
\end{equation*}
The energy and co-energy variables are related to the physical variables (fluid height and velocity) through Eqs. \eqref{eq:alpha_shwater}, \eqref{eq:e_shwater}. In this case $X_1 = L^2(\Omega),\; X_2 = L^2(\Omega, \mathbb{R}^2)$ and $\mathcal{L} = \grad, \; -\mathcal{L}^* = \div$. This implies $H^{\mathcal{L}} = H^1(\Omega), \; H^{-\mathcal{L}^*} = H^{\div}(\Omega, \mathbb{R}^2)$. As shown in \eqref{eq:enrate_shwater}, the energy rate is given by 
\begin{equation}
\dot{H} = - \inner[L^2(\Omega, \mathbb{R}^2)]{\bm{e}_v}{\grad e_h} - \inner[L^2(\Omega)]{\div \bm{e}_v}{e_h} = \inner[L^2(\partial\Omega)]{- \bm{e}_v \cdot\bm{n}}{e_h},
\end{equation}
meaning that $X_\partial = L^2(\partial\Omega)$. The boundary operators are therefore given by 
\begin{equation}
\begin{aligned}
u_\partial &= \mathcal{B}_\partial (e_h \;\; \bm{e}_v)^\top = \mathcal{N}_{\partial, 2} \bm{e}_v = -\bm\gamma_{n} \bm{e}_v = -\bm{e}_v \cdot \bm{n}\vert_{\partial\Omega}, \\ 
y_\partial &=\mathcal{C}_\partial (e_h \;\; \bm{e}_v)^\top = \mathcal{N}_{\partial, 1} {e}_h = \gamma_{0} {e}_h = {e}_h\vert_{\partial\Omega}.
\end{aligned}
\end{equation}
This system represents a particular example of the general formulation of the general framework \eqref{eq:pHsys_ass}, together with boundary conditions \eqref{eq:pHsys_assB2C1}. To obtain a finite dimensional system, the test variables $v_h,\; \bm{v}_v$ are introduced and the integration by parts is performed on the $-\mathcal{L}^* = \div$ operator, leading to the weak form 

\begin{equation}\label{eq:weak_sys_shwater_grad}
\begin{aligned}
\inner[L^2(\Omega)]{{v}_h}{\partial_t {\alpha}_h} &=  \inner[L^2(\Omega, \mathbb{R}^2)]{\grad {v}_h}{\bm{e}_v} + \inner[L^2(\partial\Omega)]{\gamma_{0} {v}_h}{\bm{u}_\partial}, \\
\inner[L^2(\Omega, \mathbb{R}^2)]{\bm{v}_v}{\partial_t \bm{\alpha}_v} &=   -\inner[L^2(\Omega, \mathbb{R}^2)]{\bm{v}_v}{\grad e_h}, \\
\inner[L^2(\Omega)]{{v}_h}{{e}_h}&= \inner[L^2(\Omega)]{v_h}{\frac{1}{2 \rho} \norm{\bm{\alpha}_v}^2 + \rho g \alpha_h}, \\
\inner[L^2(\Omega, \mathbb{R}^2)]{\bm{v}_v}{\bm{e}_v}&= \inner[L^2(\Omega, \mathbb{R}^2)]{\bm{v}_v}{\frac{1}{\rho} \alpha_h \bm{\alpha}_v}, \\
\inner[L^2(\partial\Omega)]{{v}_\partial}{{y}_\partial} &= \inner[L^2(\partial\Omega)]{{v}_\partial}{\gamma_0 {e}_h}.
\end{aligned}
\end{equation}
Introducing a Galerkin approximation as in \eqref{eq:approx_vaeb}, the finite dimensional system is obtained
\begin{equation}\label{eq:pHsys_findim_shwater}
\begin{aligned}
\begin{bmatrix}
\mathbf{M}_h & \mathbf{0} \\
\mathbf{0} & \mathbf{M}_v \\
\end{bmatrix}
\begin{pmatrix}
\dot{\bm{\alpha}}_{d, h} \\
\dot{\bm{\alpha}}_{d, v} \\
\end{pmatrix}
&= -\begin{bmatrix}
\mathbf{0} &  - \mathbf{D}_{\grad}^\top \\
\mathbf{D}_{\grad} & \mathbf{0} \\
\end{bmatrix} 
\begin{pmatrix}
\mathbf{e}_{h} \\
\mathbf{e}_{v} \\
\end{pmatrix} + 
\begin{bmatrix}
\mathbf{B}_h \\
\mathbf{0}\\
\end{bmatrix}
\mathbf{u}_\partial, \\
\begin{bmatrix}
\mathbf{M}_h & \mathbf{0} \\
\mathbf{0} & \mathbf{M}_v \\
\end{bmatrix}
\begin{pmatrix}
\mathbf{e}_{h} \\
\mathbf{e}_{v} \\
\end{pmatrix}
&= \begin{bmatrix}
\partial_{\bm{\alpha}_{d, h}} H_d(\bm{\alpha}_{d, h},\; \bm{\alpha}_{d, v})\\
\partial_{\bm{\alpha}_{d, v}} H_d(\bm{\alpha}_{d, h},\; \bm{\alpha}_{d, v})\\
\end{bmatrix}, \\
\mathbf{M}_\partial {\mathbf{y}_\partial} &= \begin{bmatrix}
\mathbf{B}_h^\top & \mathbf{0}
\end{bmatrix}\begin{pmatrix}
\mathbf{e}_{h} \\
\mathbf{e}_{v} \\
\end{pmatrix}.
\end{aligned}
\end{equation}
The matrices are defined as follows 
\begin{equation}
\begin{aligned}
M_h^{ij} &= \inner[L^2(\Omega)]{\phi_h^i}{\phi_h^j}, \\
M_v^{mn} &= \inner[L^2(\Omega, \mathbb{R}^2)]{\bm\phi_v^m}{\bm\phi_v^n}, \\
M_\partial^{lk} &= \inner[L^2(\partial\Omega)]{\phi_\partial^l}{\phi_\delta^k},
\end{aligned}\quad
\begin{aligned}
{D}_{\grad}^{mi} &= \inner[L^2(\Omega, \mathbb{R}^2)]{\bm\phi_v^m}{\grad \phi_h^i}, \\
{B}_{h}^{ik} &= \inner[L^2(\partial\Omega)]{\phi_h^i}{\phi_\partial^k}, \\
\end{aligned}
\end{equation}
where $i, j \in \left\{1, n_1\right\}, \; m,n \in \left\{1, n_2\right\}, \; l, k \in \left\{1, n_\partial \right\}$. 
The discretized gradient of the Hamiltonian read
\begin{equation}
\begin{aligned}
\partial_{{\alpha}_{d, h}^i} H_d(\bm{\alpha}_{d, h},\; \bm{\alpha}_{d, v}) &= \inner[L^2(\Omega)]{\bm\phi_h^i}{\frac{1}{2 \rho} \norm{\sum_{r=1}^{n_2} \bm{\phi}_v^r \alpha_v^r}^2 + \rho g \sum_{r=1}^{n_1} {\phi}_h^r \alpha_h^r}, \qquad i \in \left\{1, n_1\right\}, \\
\partial_{{\alpha}_{d, v}^m} H_d(\bm{\alpha}_{d, h},\; \bm{\alpha}_{d, v}) &= \inner[L^2(\Omega, \mathbb{R}^2)]{\bm\phi_v^m}{\frac{1}{\rho} \left(\sum_{r=1}^{n_1} {\phi}_h^r \alpha_h^r\right) \left(\sum_{r=1}^{n_2} \bm{\phi}_v^r \alpha_v^r \right)}, \qquad m \in \left\{1, n_2\right\}.
\end{aligned}
\end{equation}



\subsection{Linear case}
The general framework detailed in Sec. \ref{sec:pfem_gen} is valid for both linear and non linear system. However, in the linear case a major simplification occurs since the constitutive law connecting energy and co-energy variables is easily invertible. This allows using only to describe the dynamics using the co-energy variables only. \\

The additional assumption required to make the system linear is introduced.

\begin{assumption}\label{ass:quadHam}
	The Hamiltonian is assumed to be a positive quadratic functional in the energy variables $\bm{\alpha}_1, \, \bm{\alpha}_2$. Furthermore, the Hamiltonian is considered to be separable  with respect to $\bm{\alpha}_1, \, \bm{\alpha}_2$ (this hypothesis is always meet for the systems under consideration). Therefore, it can be expressed as 
	\begin{equation}
		H = \frac{1}{2} \inner[X_1]{\bm{\alpha}_{1}}{\mathcal{Q}_1\bm{\alpha}_{1}} + \frac{1}{2} \inner[X_2]{\bm{\alpha}_{2}}{\mathcal{Q}_2\bm{\alpha}_{2}},
	\end{equation}
	where $\mathcal{Q}_1, \, \mathcal{Q}_2$ are positive bounded symmetric operators, verifying
	\begin{equation*}
	m_1 \bm{I}_1 \le\mathcal{Q}_1 \le M_1 \bm{I}_1, \qquad  m_2 \bm{I}_2 \le \mathcal{Q}_2 \le M_2 \bm{I}_2.
	\end{equation*} 
\end{assumption}

Because of assumption \ref{ass:quadHam}, the co-energy variables are given by 
\begin{equation}\label{eq:e_lin}
	\bm{e}_1 := \delta_{\alpha_1} H = \mathcal{Q}_1 \bm{\alpha}_1, \qquad \bm{e}_2 := \delta_{\alpha_2} H = \mathcal{Q}_2 \bm{\alpha}_2
\end{equation}
Since $\mathcal{Q}_1, \, \mathcal{Q}_2$ are positive bounded symmetric operators, it is possible to invert them to obtain
\begin{equation}\label{eq:alpha_lin}
\bm{\alpha}_1 = \mathcal{Q}_1^{-1}\bm{e}_1 = \mathcal{M}_1\bm{e}_1, \qquad  \bm{\alpha}_2 = \mathcal{Q}_2^{-1} \bm{e}_2 = \mathcal{M}_2 \bm{e}_2, \qquad \mathcal{M}_1 := \mathcal{Q}_1^{-1}, \; \mathcal{M}_2 := \mathcal{Q}_2^{-1}.
\end{equation}
The Hamiltonian is then written in terms of co-energy variables as 
\begin{equation}\label{eq:H_coenergy}
H = \frac{1}{2} \inner[X_1]{\bm{e}_{1}}{\mathcal{M}_1\bm{e}_{1}} + \frac{1}{2} \inner[X_2]{\bm{e}_{2}}{\mathcal{M}_2\bm{e}_{2}}.
\end{equation}
Under assumptions \ref{ass:linJ}, \ref{ass:operBC}, \ref{ass:quadHam}, a pH linear system is expressed as 

\begin{equation}
	\label{eq:pHsys_dyn_linass} 
	\begin{bmatrix}
	\mathcal{M}_1 & 0 \\
	0 & \mathcal{M}_2 \\
	\end{bmatrix}
	\partial_t \begin{pmatrix}
	\bm{e}_1 \\ \bm{e}_2
	\end{pmatrix} = \begin{bmatrix}
	0 & -\bm{L}^\top - \mathcal{L}^* \\
	\bm{L} + \mathcal{L} & 0 \\
	\end{bmatrix}\begin{pmatrix}
	\bm{e}_1 \\ \bm{e}_2
	\end{pmatrix} , \qquad \begin{aligned}
	\bm{e}_1 &\in H^{\mathcal{L}}, 	\\
	\bm{e}_2 &\in H^{-\mathcal{L}^*}.
	\end{aligned}\\
\end{equation}
If Eq. \eqref{eq:assB2C1} holds the boundary variables equal 
\begin{equation}
\bm{u}_\partial = \mathcal{N}_2 \displaystyle \bm{e}_2, \qquad  \bm{y}_\partial = \mathcal{N}_1 \displaystyle \bm{e}_1, \qquad  \bm{u}_\partial,\, \bm{y}_\partial \in \mathbb{R}^m.
\end{equation}
Whereas if Eq. \eqref{eq:assB1C2} holds, then
\begin{equation}
\bm{u}_\partial = \mathcal{N}_1 \displaystyle \bm{e}_1, \qquad 
\bm{y}_\partial = \mathcal{N}_2 \displaystyle \bm{e}_2, \qquad  \bm{u}_\partial,\, \bm{y}_\partial \in \mathbb{R}^m. 
\end{equation}
From equation \eqref{eq:H_coenergy}, the power balance reads
\begin{equation}
\begin{aligned}
\dot{H} &= \inner[X_1]{\bm{e}_1}{\mathcal{M}_1 \partial_{t} \bm{e}_1} + \inner[X_2]{\bm{e}_2}{\mathcal{M}_2 \partial_{t} \bm{e}_2}, \\
&=\inner[X_1]{\bm{e}_1}{-\mathcal{L}^* \bm{e}_2} + \inner[X_2]{\bm{e}_2}{\mathcal{L} \bm{e}_1}, \\
&= \inner[X_\partial]{\mathcal{N}_{\partial, 1} \bm{e}_1}{\mathcal{N}_{\partial, 2} \bm{e}_2}, \\
&= \inner[X_\partial]{\bm{y}_\partial}{\bm{u}_\partial}.
\end{aligned}
\end{equation}
To get a finite dimensional approximation the same procedure detailed in Sec. \secref{sec:pfem_gen} is followed. The only difference is that there is no need to discretize the constitutive relations as those are already incorporate in the dynamics. 

Once the system is put into weak form, if the operator $\mathcal{-L^*}$ is integrated by parts, one obtains the weak form 
\begin{equation}\label{eq:weak_linsys_intJ1}
\begin{aligned}
\inner[X_1]{\bm{v}_1}{\mathcal{M}_1 \partial_t \bm{e}_1} &=   -  \langle{\bm{v}_1}, \,{\bm{L}^\top \bm{e}_2}\rangle_{X_1}  -\inner[X_2]{\mathcal{L}\bm{v}_1}{\bm{e}_2} + \inner[X_\partial]{\mathcal{N}_{\partial, 1} \bm{v}_1}{\bm{u}_\partial}, \\
\inner[X_2]{\bm{v}_2}{\mathcal{M}_2 \partial_t \bm{e}_2} &=   \inner[X_2]{\bm{v}_2}{\bm{L}\bm{e}_1} + \inner[X_2]{\bm{v}_2}{\mathcal{L}\bm{e}_1}, \\
\inner[X_\partial]{\bm{v}_\partial}{\bm{y}_\partial} &= \inner[X_\partial]{\bm{v}_\partial}{\mathcal{N}_{\partial, 1}\bm{e}_2}.
\end{aligned}
\end{equation}

Otherwise, if operator $\mathcal{L}$ is integrated by parts, it is found  
\begin{equation}\label{eq:weak_linsys_intJ2}
\begin{aligned}
\inner[X_1]{\bm{v}_1}{\mathcal{M}_1 \partial_t \bm{e}_1} &=   -  \langle{\bm{v}_1}, \,{\bm{L}^\top \bm{e}_2}\rangle_{X_1}  -\inner[X_1]{\bm{v}_1}{\mathcal{L}^*\bm{e}_2}, \\
\inner[X_2]{\bm{v}_2}{\mathcal{M}_2 \partial_t \bm{e}_2} &=   \inner[X_2]{\bm{v}_2}{\bm{L}\bm{e}_1}  + \inner[X_1]{\mathcal{L}^*\bm{v}_2}{\bm{e}_1} + \inner[X_\partial]{\mathcal{N}_{\partial, 2} \bm{v}_2}{\bm{u}_{\partial}}, \\
\inner[X_\partial]{\bm{v}_\partial}{\bm{y}_\partial} &= \inner[X_\partial]{\bm{v}_\partial}{\mathcal{N}_{\partial, 2}\bm{e}_2}.
\end{aligned}
\end{equation}
After introducing a Galerkin approximation as in \eqref{eq:approx_vaeb}, the discretized version of the weak form \eqref{eq:weak_linsys_intJ1} reads

\begin{equation}\label{eq:pHlinsys_findim_J1}
\begin{aligned}
\begin{bmatrix}
\mathbf{M}_{\mathcal{M}_1} & \mathbf{0} \\
\mathbf{0} & \mathbf{M}_{\mathcal{M}_2} \\
\end{bmatrix}
\begin{pmatrix}
\dot{\mathbf{e}}_{1} \\
\dot{\mathbf{e}}_{2} \\
\end{pmatrix}
&= \begin{bmatrix}
\mathbf{0} & -\mathbf{D}_{0}^\top - \mathbf{D}_{\mathcal{L}}^\top \\
\mathbf{D}_{0} + \mathbf{D}_{\mathcal{L}} & \mathbf{0} \\
\end{bmatrix} 
\begin{pmatrix}
\mathbf{e}_{1} \\
\mathbf{e}_{2} \\
\end{pmatrix} + 
\begin{bmatrix}
\mathbf{B}_1\\
\mathbf{0}\\
\end{bmatrix}
\mathbf{u}_\partial, \\
\mathbf{M}_\partial {\mathbf{y}_\partial} &= \begin{bmatrix}
\mathbf{B}_1^\top & \mathbf{0}
\end{bmatrix}\begin{pmatrix}
\mathbf{e}_{1} \\
\mathbf{e}_{2} \\
\end{pmatrix}.
\end{aligned}
\end{equation}
The only difference with respect to Eq. \eqref{eq:pHsys_findim_J1} concerns the mass matrices
\begin{equation}
M_1^{ij} = \inner[X_1]{\bm\phi_1^i}{\mathcal{M}_1 \bm\phi_1^j}, \qquad
M_2^{mn} = \inner[X_2]{\bm\phi_2^m}{\mathcal{M}_2 \bm\phi_2^n} \qquad i, j \in \{1, n_1\}, \; m,n \in \{1, n_2\}. 
\end{equation}
If the Galerkin approximation is applied to the weak form \eqref{eq:weak_linsys_intJ2}, it is obtained
\begin{equation}\label{eq:pHlinsys_findim_J2}
\begin{aligned}
\begin{bmatrix}
\mathbf{M}_{\mathcal{M}_1} & \mathbf{0} \\
\mathbf{0} & \mathbf{M}_{\mathcal{M}_2} \\
\end{bmatrix}
\begin{pmatrix}
\dot{\mathbf{e}}_{1} \\
\dot{\mathbf{e}}_{2} \\
\end{pmatrix}
&= \begin{bmatrix}
\mathbf{0} & -\mathbf{D}_{0}^\top + \mathbf{D}_{-\mathcal{L}^*} \\
\mathbf{D}_{0} - \mathbf{D}_{-\mathcal{L}^*}^\top & \mathbf{0} \\
\end{bmatrix} 
\begin{pmatrix}
\mathbf{e}_{1} \\
\mathbf{e}_{2} \\
\end{pmatrix} + 
\begin{bmatrix}
\mathbf{0}\\
\mathbf{B}_2\\
\end{bmatrix}
\mathbf{u}_\partial, \\
\mathbf{M}_\partial {\mathbf{y}_\partial} &= 
\begin{bmatrix}
\mathbf{0} & \mathbf{B}_2^\top 
\end{bmatrix}\begin{pmatrix}
\mathbf{e}_{1} \\
\mathbf{e}_{2} \\
\end{pmatrix}.
\end{aligned}
\end{equation}

\subsection{Some examples of linear flexible structures}

In this section, some linear example from the elasticity realms are considered. We restrict the discussion to linear problems. This case is anyway significant, as these examples are frequently encountered in engineering applications. 

\subsection{Euler-Bernoulli beam}
We reconsider the example discussed in Sec. \secref{sec:beamEB}. Given an interval $\Omega = (0, \, L)$, a thin beam under free boundary condition can be modeled in terms of co-energy variables by the following system

\begin{subequations}\label{eq:pHlinsys_EB1}
\begin{align}
\begin{bmatrix}
\rho A & 0 \\
0 &(EI)^{-1} \\
\end{bmatrix}
\diffp{}{t}\begin{pmatrix}
e_w \\ e_\kappa \\
\end{pmatrix} &= \begin{bmatrix}
0 & -\partial_{xx} \\
\partial_{xx} & 0 \\
\end{bmatrix} \begin{pmatrix}
e_w \\ e_\kappa \\
\end{pmatrix}, \qquad \begin{aligned}
e_w \in H^2(\Omega), \\
e_\kappa \in H^2(\Omega), \\
\end{aligned} \label{eq:pHdyn_EB1}\\
\bm{u}_\partial &= \begin{bmatrix}
0 &\bm\gamma_{0} \\
0 &-\bm\gamma_{1} 
\end{bmatrix} \begin{pmatrix}
e_w \\ e_\kappa \\
\end{pmatrix}, \qquad \; \bm{u}_\partial \in \mathbb{R}^4,  \\
\bm{y}_\partial &= \begin{bmatrix}
\bm\gamma_{1} & 0\\
\bm\gamma_{0} & 0 
\end{bmatrix} \begin{pmatrix}
e_w \\ e_\kappa \\
\end{pmatrix}, \qquad \quad \, \bm{y}_\partial \in \mathbb{R}^4.
\end{align}
\end{subequations}
The coefficients $\rho, E$ and $I$  are the mass per unit length, Young's modulus of elasticity and the moment of inertia of a cross section.  The boundary operator $\bm\gamma_0, \, \bm\gamma_{1}$ denote the trace and the first derivative trace along the boundary. In a one-dimensional domain the boundary degenerates to two single points
\begin{equation}
	\bm\gamma_0 a = a\vert_{\partial\Omega} = \begin{pmatrix}
	-a(0) \\ +a(L)
	\end{pmatrix}, \qquad \bm\gamma_1 a = \partial_x a\vert_{\partial\Omega} = \begin{pmatrix}
	-\partial_x a(0) \\ +\partial_x a(L)
	\end{pmatrix}
\end{equation}
In this case $\mathcal{L} = \partial_{xx}$ and $X_1 = X_2 = L^2(\Omega), \; X_\partial = \mathbb{R}^4$. The boundary operators $N_{\partial, 1}, \, N_{\partial, 2}$ read
\begin{equation}
N_{\partial, 1} = \begin{bmatrix}
\bm\gamma_1 \\ \bm\gamma_0
\end{bmatrix}, \qquad 
N_{\partial, 2} = \begin{bmatrix}
\bm\gamma_0 \\ -\bm\gamma_1
\end{bmatrix}.
\end{equation}

The Hamiltonian is given by 
\begin{equation}
H = \energy{\rho A \ e_w^2 + (EI)^{-1}\ e_\kappa^2}.
\end{equation}
Applying twice the integration by parts formula, one obtains the power balance
\begin{equation}
\begin{aligned}
\dot{H} &= \inner[L^2(\Omega)]{e_w}{\rho A \ \partial_{t} e_w} + \inner[L^2(\Omega)]{e_\kappa}{(E I)^{-1} \ \partial_{t} e_\kappa}, \\
&=\inner[L^2(\Omega)]{e_w}{-\partial_{xx} e_\kappa} + \inner[L^2(\Omega)]{e_\kappa}{\partial_{xx} e_w}, \\
&=\inner[\mathbb{R}^2]{\bm\gamma_{1} e_w}{\bm\gamma_{0} e_\kappa} + \inner[\mathbb{R}^2]{\bm\gamma_{0} e_w}{-\bm\gamma_{1} e_\kappa}, \\
&= \inner[\mathbb{R}^4]{\bm{y}_\partial}{\bm{u}_\partial}
\end{aligned}
\end{equation}
Given the test functions $v_w, \; v_\kappa$, the weak form is readily obtained as 
\begin{equation}
\begin{aligned}
\inner[L^2(\Omega)]{v_w}{\rho A \partial_t e_w} &= \inner[L^2(\Omega)]{v_w}{-\partial_{xx} e_\kappa}, \\
\inner[L^2(\Omega)]{v_\kappa}{(EI)^{-1} \partial_t e_\kappa} &= \inner[L^2(\Omega)]{v_\kappa}{\partial_{xx} e_w}, \\
\end{aligned}
\end{equation}
If the integration by parts is applied twice to the first line of Eq. \eqref{eq:pHdyn_EB1}, it is obtained
\begin{equation}
\begin{aligned}
\inner[L^2(\Omega)]{v_w}{\rho A \partial_t e_w} &= -\inner[L^2(\Omega)]{\partial_{xx} v_w}{e_\kappa} + \inner[\mathbb{R}^2]{\bm\gamma_1 v_w}{({u}_{\partial, 1}, {u}_{\partial, 2})} + \inner[\mathbb{R}^2]{\bm\gamma_0 v_w}{({u}_{\partial, 3}, {u}_{\partial, 4})}, \\
\inner[L^2(\Omega)]{v_\kappa}{(EI)^{-1} \partial_t e_\kappa} &= \inner[L^2(\Omega)]{v_\kappa}{\partial_{xx} e_w}. \\
\end{aligned}
\end{equation}
Introducing a Galerkin discretization for test and efforts functions
\begin{equation}
v_w = \sum_{i = 1}^{n_w} \phi_w^i v_w^i, \qquad e_w = \sum_{i = 1}^{n_w} \phi_w^i e_w^i(t),
\qquad v_\kappa = \sum_{i = 1}^{n_\kappa} \phi_\kappa^i v_\kappa^i, \qquad e_\kappa = \sum_{i = 1}^{n_\kappa} \phi_\kappa^i e_\kappa^i(t),
\end{equation} 
 and considering that $\bm{u}_\partial \in \mathbb{R}^4, \bm{y}_\partial \in \mathbb{R}^4$, the following is obtained
\begin{equation}
\begin{aligned}
\begin{bmatrix}
\mathbf{M}_{\rho A} & \mathbf{0} \\
\mathbf{0} & \mathbf{M}_{EI^{-1}} \\
\end{bmatrix}
\begin{pmatrix}
\dot{\mathbf{e}}_{w} \\
\dot{\mathbf{e}}_{\kappa} \\
\end{pmatrix}
&= \begin{bmatrix}
\mathbf{0} & - \mathbf{D}_{\partial_{xx}}^\top \\
\mathbf{D}_{\partial_{xx}} & \mathbf{0} \\
\end{bmatrix} 
\begin{pmatrix}
\mathbf{e}_{w} \\
\mathbf{e}_{\kappa} \\
\end{pmatrix} + 
\begin{bmatrix}
\mathbf{B}_1\\
\mathbf{0}\\
\end{bmatrix}
\mathbf{u}_\partial, \\
{\mathbf{y}_\partial} &= \begin{bmatrix}
\mathbf{B}_1^\top & \mathbf{0}
\end{bmatrix}\begin{pmatrix}
\mathbf{e}_{w} \\
\mathbf{e}_{\kappa} \\
\end{pmatrix}.
\end{aligned}
\end{equation}
The matrices $\mathbf{M}_{\rho A}, \; \mathbf{M}_{EI^{-1}}, \; 
\mathbf{D}_{\partial_{xx}}$ are defined as ($i, j \in \{1, n_w\}, \; m, n \in \{1, n_\kappa\}$)
\begin{equation}
M_{\rho A}^{ij} = \inner[L^2(\Omega)]{\phi_w^i}{\rho A \phi_w^j}, \quad
M_{{EI}^{-1}}^{mn} = \inner[L^2(\Omega)]{\phi_\kappa^m}{(EI)^{-1}\phi_\kappa^n}, \quad D_{\partial_{xx}}^{mi} = \inner[L^2(\Omega)]{\phi_\kappa^m}{\partial_{xx} \phi_w^i}.
\end{equation}
The $\mathbf{B}_1$ is composed of four column vectors $\mathbf{B}_1 = [\mathbf{b}_1 \; \mathbf{b}_2 \; \mathbf{b}_3 \; \mathbf{b}_4]$
\begin{equation}
{b}_1^i = -\partial_x \phi_w^i(0), \qquad {b}_2^i = \partial_x \phi_w^i(L), \qquad {b}_3^i = -\phi_w^i(0), \qquad {b}_4^i = \phi_w^i(L), \qquad i \in \{1, n_1\}.
\end{equation}
Equivalently, the second line of Eq. \eqref{eq:pHdyn_EB1} could have been integrated by parts to control trough the linear and angular velocities at the extremities. Consider the system with the opposite causality
\begin{subequations}\label{eq:pHlinsys_EB2}
	\begin{align}
	\begin{bmatrix}
	\rho A & 0 \\
	0 &(EI)^{-1} \\
	\end{bmatrix}
	\diffp{}{t}\begin{pmatrix}
	e_w \\ e_\kappa \\
	\end{pmatrix} &= \begin{bmatrix}
	0 & -\partial_{xx} \\
	\partial_{xx} & 0 \\
	\end{bmatrix} \begin{pmatrix}
	e_w \\ e_\kappa \\
	\end{pmatrix}, \qquad \begin{aligned}
	e_w \in H^2(\Omega), \\
	e_\kappa \in H^2(\Omega), \\
	\end{aligned}\\
	\bm{u}_\partial &= \begin{bmatrix}
	\bm\gamma_{1} & 0\\
	\bm\gamma_{0} & 0 
	\end{bmatrix}
	\begin{pmatrix}
	e_w \\ e_\kappa \\
	\end{pmatrix}, \qquad \quad   \bm{u}_\partial \in \mathbb{R}^4,  \\
	\bm{y}_\partial &= \begin{bmatrix}
	0 &\bm\gamma_{0} \\
	0 &-\bm\gamma_{1} 
	\end{bmatrix} \begin{pmatrix}
	e_w \\ e_\kappa \\
	\end{pmatrix}, \qquad \; \bm{y}_\partial \in \mathbb{R}^4.
	\end{align}
\end{subequations}

This possibility  Indeed, to lower the regularity requirement for the finite elements, both lines can be integrated by parts. 


\section{Inhomogeneous boundary conditions}\label{sec:mixedbc}

\subsection{Solution using Lagrange multipliers}

\subsection{Virtual domain decomposition}


\section{Connection with mixed finite elements}




